{
  "enabled": true,
  "title": "SLO low - user experience success rate",
  "description": "SLO Burn rate on user experience success rate",
  "source": "SLO",
  "executionSettings": {},
  "analyzer": {
    "name": "dt.statistics.ui.anomaly_detection.StaticThresholdAnomalyDetectionAnalyzer",
    "input": [
      {
        "key": "query",
		"value": "fetch dt.entity.application\n| filter matchesPhrase(tags,\"slo\")\n| fieldsAdd dt.rum.application.entity=id\n| join [\n   timeseries { total=sum(dt.frontend.request.count),failures=sum(dt.frontend.error.count) }\n  , by: { dt.rum.application.entity }\n  //, filter: {matchesPhrase(entityAttr(dt.entity.application,\"tags\"),\"slo\")}\n], on:{dt.rum.application.entity}, kind:leftOuter\n| fields timeframe=right.timeframe, interval=right.interval, sli=(((right.total[]-right.failures[])/right.total[])*(100)),\n entityName(dt.rum.application.entity, type: \"dt.entity.application\")\n// ADD THIS SECTION TO CALCULATE THE BURN RATE for single service-entities\n| fieldsAdd target = {{ .target_lowslo_userexperiencesuccessrate }}  //ADD the SLO target\n| fieldsAdd burnRate = ((100 - sli[]) / (100 - target)) // BurnRate = Error Rate / Error Budget\n| fieldsRemove sli"
      },
      {
        "key": "threshold",
        "value": "{{ .burnrate_lowslo_userexperiencesuccessrate }}"
      },
      {
        "key": "alertCondition",
        "value": "ABOVE"
      },
      {
        "key": "alertOnMissingData",
        "value": "true"
      },
      {
        "key": "violatingSamples",
        "value": "{{ .violatingsamples_lowslo_userexperiencesuccessrate }}"
      },
      {
        "key": "slidingWindow",
        "value": "{{ .slingwindow_lowslo_userexperiencesuccessrate }}"
      },
      {
        "key": "dealertingSamples",
        "value": "{{ .dealertingsamples_lowslo_userexperiencesuccessrate }}"
      }
    ]
  },
  "eventTemplate": {
    "properties": [
      {
        "key": "dt.source_entity",
        "value": "{dims:dt.rum.application.entity}"
      },
      {
        "key": "event.type",
        "value": "CUSTOM_ALERT"
      },
      {
        "key": "event.description",
        "value": "low burn rate alert, affecting: {dims:dt.rum.application.entity}"
      },
      {
        "key": "event.name",
        "value": "SLO Burn rate on user experience success rate"
      }
    ]
  }
}